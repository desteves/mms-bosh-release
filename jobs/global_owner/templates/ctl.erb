#!/bin/bash
set -e

USER=<%= properties.mms.user  %>
PASS=<%= properties.mms.pwd %>
FQDN=<%= properties.mms.fqdn %>
PORT=<%= properties.mms.port %>
MMSG=<%= properties.mms.org %>

echo "Waiting for HTTP(S) to load..."
waittime=30 # seconds

if [[ -f $(curl localhost:8080/user#/ops/login -m $waittime -f --retry-connrefused --retry 4 --retry-delay $waittime ); then
    echo "Failed to register Global Owner. Check Logs and Try Again"
    exit 1
fi


echo "Registering admin user (username: $USER, password: $PASS)"
###  Your password must be at least eight (8) characters long and contain at least one letter, one digit and one special character.
curl -X POST \
http://${FQDN}:${PORT}/user/registerCall \
  -H 'cache-control: no-cache' \
  -H 'content-type: application/json' \
  -d '{"username":"$USER","password":"$PASS","firstName":"Global","lastName":"Owner","newGroup":true,"jobResponsibility":"","response":""}'
